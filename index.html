<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Reflex Test ‚ö° Arcade Edition</title>

<!-- SOCIAL META -->
<meta property="og:title" content="Reflex Test ‚Äì Arcade Edition">
<meta property="og:description" content="Tap as fast as you can when the button turns green! Test your reflexes now.">
<meta property="og:image" content="https://reflex-rho.vercel.app/logo.png">

<!-- FARCASTER MINIAPP EMBED -->
<meta name="fc:miniapp" content='{
  "version": "1",
  "imageUrl": "https://reflex-rho.vercel.app/logo.png",
  "button": {
    "title": "‚ö° Play Reflex Test",
    "action": {
      "type": "launch_miniapp",
      "url": "https://reflex-rho.vercel.app/index.html",
      "name": "Reflex Test",
      "splashImageUrl": "https://reflex-rho.vercel.app/logo.png",
      "splashBackgroundColor": "#000000"
    }
  }
}' />

<style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap');
    body {
        font-family: "Orbitron", sans-serif;
        background: radial-gradient(circle at center, #0a0f1e, #000);
        color: #0ff6d1;
        text-align: center;
        padding: 30px;
        overflow-x: hidden;
    }
    body::before {
        content: "";
        position: fixed;
        inset: 0;
        background: linear-gradient(#0ff6d122 1px, transparent 1px),
                    linear-gradient(90deg, #0ff6d122 1px, transparent 1px);
        background-size: 45px 45px;
        animation: gridMove 14s linear infinite;
        z-index: -1;
    }
    @keyframes gridMove { 0% { transform: translateY(0); } 100% { transform: translateY(45px); } }

    #gameLogo {
        width: 260px; margin: 0 auto 20px auto; display: block;
        animation: logoAppear 1.2s ease-out forwards, logoGlow 2.5s ease-in-out infinite;
        opacity: 0;
    }
    @keyframes logoAppear { 0% { transform: scale(0.6) translateY(-20px); opacity: 0; } 100% { transform: scale(1) translateY(0); opacity: 1; } }
    @keyframes logoGlow { 0% { filter: drop-shadow(0 0 6px #0ff); } 50% { filter: drop-shadow(0 0 16px #0ff); } 100% { filter: drop-shadow(0 0 6px #0ff); } }

    #status { font-size: 22px; margin-bottom: 20px; color: #8efff6; min-height: 28px; }

    #reactionButton {
        width: 230px; height: 230px; border-radius: 50%; border: 4px solid #00e6c7;
        background: radial-gradient(circle, #062e29, #001513);
        font-size: 26px; color: #0ff6d1;
        cursor: pointer; transition: 0.25s;
        box-shadow: 0 0 25px #00ffd5cc, inset 0 0 25px #00ffd555;
    }
    .glow { animation: neonGlow 1.5s ease-in-out infinite; }
    @keyframes neonGlow { 0% { box-shadow: 0 0 12px #00ffd5; } 50% { box-shadow: 0 0 40px #00ffd5; } 100% { box-shadow: 0 0 12px #00ffd5; } }
    .readyPulse { animation: pulse 0.25s; }
    @keyframes pulse { 0% { transform: scale(1);} 40% {transform: scale(1.18);} 100% {transform: scale(1);} }

    #score { margin-top: 25px; font-size: 34px; font-weight: bold; color: #00ffe1; }

    .actionBtn {
        margin: 15px 10px; padding: 14px 24px; font-size: 18px;
        border-radius: 10px; border: 2px solid #00e6c7;
        background: #012e28; color: #00ffe1;
        box-shadow: 0 0 12px #00ffd566; cursor: pointer;
        transition: 0.2s;
    }
    .actionBtn:hover { transform: scale(1.1); box-shadow: 0 0 22px #00ffd5; }
    .hidden { display: none; }
</style>
</head>

<body>

<img id="gameLogo" src="logo.png" alt="Reflex Test Logo">

<div id="status">Press START to begin.</div>

<button id="reactionButton">START</button>
<div id="score" class="hidden"></div>

<button id="againBtn" class="actionBtn hidden">Play Again</button>
<button id="shareBtn" class="actionBtn hidden">Share Score</button>

<script>
let gameState = "idle";
let startTime = 0;
let timeoutID;

const soundReady = new Audio("ready.mp3");
const soundFail = new Audio("fail.mp3");
const soundWin = new Audio("win.mp3");

const btn = document.getElementById("reactionButton");
const statusText = document.getElementById("status");
const scoreText = document.getElementById("score");
const againBtn = document.getElementById("againBtn");
const shareBtn = document.getElementById("shareBtn");

btn.addEventListener("click", () => {
    if (gameState === "idle") startGame();
    else if (gameState === "ready") tooEarly();
    else if (gameState === "go") stopTimer();
});

againBtn.addEventListener("click", resetGame);
shareBtn.addEventListener("click", () => shareScore(scoreText.innerText.replace(" s", "")));

function startGame() {
    gameState = "ready";
    statusText.innerText = "Get ready...";
    btn.innerText = "WAIT";
    btn.classList.add("glow");
    btn.style.background = "#2a2e0f";

    const waitTime = Math.random() * 3000 + 1500;

    timeoutID = setTimeout(() => {
        gameState = "go";
        btn.classList.remove("glow");
        btn.classList.add("readyPulse");
        btn.style.background = "#0f4d3e";
        btn.innerText = "TAP!";
        statusText.innerText = "NOW! üü¢";
        soundReady.play();
        navigator.vibrate(120);
        startTime = Date.now();
    }, waitTime);
}

function tooEarly() {
    clearTimeout(timeoutID);
    gameState = "idle";
    statusText.innerText = "Too early! üòÖ";
    btn.style.background = "#3a0f0f";
    btn.innerText = "START";
    btn.classList.remove("glow", "readyPulse");
    soundFail.play();
    navigator.vibrate([80, 80]);
}

function stopTimer() {
    const reactionTime = ((Date.now() - startTime) / 1000).toFixed(3);
    statusText.innerText = "Nice reflex! üéâ";
    scoreText.innerText = reactionTime + " s";
    scoreText.classList.remove("hidden");

    gameState = "finished";
    againBtn.classList.remove("hidden");
    shareBtn.classList.remove("hidden");

    btn.style.background = "#122225";
    btn.innerText = "‚úî";
    btn.classList.remove("glow", "readyPulse");
    soundWin.play();
    navigator.vibrate([150, 80, 150]);
}

function resetGame() {
    gameState = "idle";
    statusText.innerText = "Press START to begin.";
    scoreText.classList.add("hidden");
    againBtn.classList.add("hidden");
    shareBtn.classList.add("hidden");

    btn.innerText = "START";
    btn.style.background = "#062e29";
}
</script>

<!-- MINIAPP SDK (DOƒûRU VE TEK S√úR√úM) -->
<script type="module">
import * as sdk from "https://esm.sh/@farcaster/miniapp-sdk";

window.farcasterSDK = sdk;

window.addEventListener("DOMContentLoaded", () => {
    try {
        sdk.actions.ready();   // ‚Üê BUNUN DOƒûRU √áALI≈ûMASI PREVIEW'ƒ∞ D√úZELTƒ∞YOR
        console.log("‚úì MiniApp READY");
    } catch (err) {
        console.error("MiniApp SDK ready() error:", err);
    }
});

async function shareScore(score) {
  const shareImage = `https://reflex-rho.vercel.app/api/score-image?score=${score}`;

  const text =
    `‚ö° Reflex Test ‚Äî Arcade Mode\n\n` +
    `I just hit **${score}s** ‚ö°\n` +
    `Think you‚Äôre faster? Tap in and prove it. üëá\n\n`;

  const composeUrl =
    "https://warpcast.com/~/compose?text=" +
    encodeURIComponent(text) +
    "&embeds[]=" +
    encodeURIComponent(shareImage);

  try {
    await sdk.actions.openUrl({ url: composeUrl });
  } catch (err) {
    console.log("Share failed:", err);
  }
}
</script>

</body>
</html>
