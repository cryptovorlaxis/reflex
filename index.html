<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Reflex Test âš¡ Arcade Edition</title>
Â 
<meta property="og:title" content="Reflex Test â€“ Arcade Edition">
<meta property="og:description" content="Tap as fast as you can when the button turns green! Test your reflexes now.">
<meta property="og:image" content="https://reflex-rho.vercel.app/screenshot1.png">

<meta name="fc:miniapp" content='{
Â  "version": "1",
Â  "imageUrl": "https://reflex-rho.vercel.app/screenshot1.png",
Â  "button": {
Â  Â  "title": "âš¡ Play Reflex Test",
Â  Â  "action": {
Â  Â  Â  "type": "launch_miniapp",
Â  Â  Â  "url": "https://reflex-rho.vercel.app",
Â  Â  Â  "name": "Reflex Test",
Â  Â  Â  "splashImageUrl": "https://reflex-rho.vercel.app/screenshot1.png",
Â  Â  Â  "splashBackgroundColor": "#000000"
Â  Â  }
Â  }
}' />

<style>
    /* **YENÄ°: Ana Tema DeÄŸiÅŸkenleri** */
    :root {
        --neon-primary: #00ffe1; /* AÃ§Ä±k Cyan */
        --neon-secondary: #ff0073; /* Pembe (Hata/Aksan) */
        --bg-dark: #0a0f1e;
        --bg-medium: #062e29;
    }

    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&display=swap');
    
    body {
        font-family: "Orbitron", sans-serif;
        background: radial-gradient(circle at center, var(--bg-dark), #000);
        color: var(--neon-primary);
        text-align: center;
        padding: 20px 0;
        overflow-x: hidden;
        min-height: 100vh;
    }
    
    /* **YENÄ°: Merkezi Ä°Ã§erik AlanÄ±** */
    .container {
        max-width: 450px;
        margin: 0 auto;
        padding: 10px;
    }

    body::before {
        content: "";
        position: fixed;
        inset: 0;
        background: linear-gradient(var(--neon-primary) 1px, transparent 1px),
                    linear-gradient(90deg, var(--neon-primary) 1px, transparent 1px);
        background-size: 45px 45px;
        opacity: 0.1; 
        animation: gridMove 14s linear infinite;
        z-index: -1;
    }
    @keyframes gridMove { 0% { transform: translateY(0); } 100% { transform: translateY(45px); } }

    #gameLogo {
        width: 260px; margin: 0 auto 20px auto; display: block;
        filter: drop-shadow(0 0 10px var(--neon-primary)); 
        animation: logoAppear 1.2s ease-out forwards, logoGlow 2.5s ease-in-out infinite;
        opacity: 0;
    }
    @keyframes logoAppear { 0% { transform: scale(0.6) translateY(-20px); opacity: 0; } 100% { transform: scale(1) translateY(0); opacity: 1; } }
    @keyframes logoGlow { 0% { filter: drop-shadow(0 0 6px var(--neon-primary)); } 50% { filter: drop-shadow(0 0 16px var(--neon-primary)); } 100% { filter: drop-shadow(0 0 6px var(--neon-primary)); } }

    /* **YENÄ°: Status Metinleri** */
    #status { 
        font-size: 20px; 
        margin-bottom: 25px; 
        color: var(--neon-primary); 
        min-height: 28px;
        text-shadow: 0 0 8px #fff, 0 0 12px var(--neon-primary); 
    }
    
    /* **YENÄ°: Durum Renkleri (JS'te kullanÄ±lacak)** */
    .status-success { color: #fff; text-shadow: 0 0 8px #fff, 0 0 15px var(--neon-primary); }
    .status-fail { color: #f00; text-shadow: 0 0 8px #ff0000, 0 0 15px var(--neon-secondary); }


    #reactionButton {
        width: 230px; height: 230px; border-radius: 50%; 
        border: 5px solid var(--neon-primary);
        background: radial-gradient(circle, #062e29, #001513);
        font-size: 32px; 
        color: var(--neon-primary);
        cursor: pointer; transition: 0.25s, box-shadow 0.3s;
        box-shadow: 0 0 25px var(--neon-primary), inset 0 0 25px var(--neon-primary);
    }
    .glow { 
        animation: neonGlow 1.5s ease-in-out infinite; 
        background: radial-gradient(circle, #2a2e0f, #151000);
    }
    @keyframes neonGlow { 
        0% { box-shadow: 0 0 12px var(--neon-primary); } 
        50% { box-shadow: 0 0 40px var(--neon-primary), 0 0 60px rgba(0, 255, 209, 0.4); }
        100% { box-shadow: 0 0 12px var(--neon-primary); } 
    }
    .readyPulse { animation: pulse 0.25s; }
    @keyframes pulse { 0% { transform: scale(1);} 40% {transform: scale(1.18);} 100% {transform: scale(1);} }

    /* **YENÄ°: Score Metni** */
    #score { 
        margin-top: 25px; 
        font-size: 40px; 
        font-weight: 900;
        color: #fff; 
        text-shadow: 0 0 10px var(--neon-primary), 0 0 20px var(--neon-primary);
    }

    .actionBtn {
        margin: 15px 10px; padding: 16px 28px;
        font-size: 18px;
        border-radius: 10px; border: 2px solid var(--neon-primary);
        background: var(--bg-medium); 
        color: var(--neon-primary);
        box-shadow: 0 0 12px var(--neon-primary); 
        cursor: pointer;
        transition: 0.2s, box-shadow 0.4s;
    }
    .actionBtn:hover { 
        transform: scale(1.05);
        box-shadow: 0 0 20px var(--neon-primary), 0 0 30px rgba(0, 255, 209, 0.6); 
    }
    .hidden { display: none; }
</style>
</head>

<body>

<div class="container">
    <img id="gameLogo" src="logo.png" alt="Reflex Test Logo">

    <div id="status" class="status-success">Press START to begin.</div>

    <button id="reactionButton">START</button>
    <div id="score" class="hidden"></div>

    <button id="againBtn" class="actionBtn hidden">Play Again</button>
    <button id="shareBtn" class="actionBtn hidden">Share Score</button>
</div>

<script>
let gameState = "idle";
let startTime = 0;
let timeoutID;

// Dosyalar Root'ta olduÄŸu iÃ§in yollar temiz
const soundReady = new Audio("ready.mp3");
const soundFail = new Audio("fail.mp3");
const soundWin = new Audio("win.mp3");

const btn = document.getElementById("reactionButton");
const statusText = document.getElementById("status");
const scoreText = document.getElementById("score");
const againBtn = document.getElementById("againBtn");
const shareBtn = document.getElementById("shareBtn");

// Sesleri durdurup tekrar oynatmak iÃ§in yardÄ±mcÄ± fonksiyon (Ã‡akÄ±ÅŸmayÄ± Ã¶nler)
function playSound(sound) {
    if (sound) {
        sound.pause();
        sound.currentTime = 0;
        sound.play();
    }
}

// TitreÅŸim iÃ§in yardÄ±mcÄ± fonksiyon (daha gÃ¼venli)
function safeVibrate(pattern) {
    if (navigator.vibrate) {
        navigator.vibrate(pattern);
    }
}

btn.addEventListener("click", () => {
    if (gameState === "idle") startGame();
    else if (gameState === "ready") tooEarly();
    else if (gameState === "go") stopTimer();
});

againBtn.addEventListener("click", resetGame);
shareBtn.addEventListener("click", () => shareScore(scoreText.innerText.replace(" s", "")));

function startGame() {
    gameState = "ready";
    statusText.innerText = "Get ready...";
    
    // YENÄ°: BaÅŸlangÄ±Ã§ta baÅŸarÄ± sÄ±nÄ±fÄ± ekle
    statusText.classList.remove("status-fail");
    statusText.classList.add("status-success");

    btn.innerText = "WAIT";
    btn.classList.add("glow");
    btn.style.background = "#2a2e0f";

    clearTimeout(timeoutID);

    const waitTime = Math.random() * 3000 + 1500;

    timeoutID = setTimeout(() => {
        gameState = "go";
        btn.classList.remove("glow");
        btn.classList.add("readyPulse");
        btn.style.background = "#0f4d3e";
        btn.innerText = "TAP!";
        statusText.innerText = "NOW! ðŸŸ¢";
        
        playSound(soundReady);
        safeVibrate(120);
        
        startTime = Date.now();
    }, waitTime);
}

function tooEarly() {
    clearTimeout(timeoutID);
    gameState = "too_early_delay"; 
    statusText.innerText = "Too early! ðŸ˜…";
    
    // YENÄ°: Hata sÄ±nÄ±fÄ± eklendi
    statusText.classList.remove("status-success");
    statusText.classList.add("status-fail");
    
    btn.style.background = "#3a0f0f";
    btn.innerText = "STOP!";
    btn.classList.remove("glow", "readyPulse");
    
    playSound(soundFail);
    safeVibrate([80, 80]);
    
    // UX GeliÅŸtirme: 1 saniye sonra oyunu sÄ±fÄ±rla
    setTimeout(() => {
        if (gameState === "too_early_delay") {
             resetGame(); 
        }
    }, 1000); 
}

function stopTimer() {
    const reactionTime = ((Date.now() - startTime) / 1000).toFixed(3);
    statusText.innerText = "Nice reflex! ðŸŽ‰";
    scoreText.innerText = reactionTime + " s";
    scoreText.classList.remove("hidden");
    
    // YENÄ°: BaÅŸarÄ± sÄ±nÄ±fÄ± korundu
    statusText.classList.remove("status-fail");
    statusText.classList.add("status-success");

    gameState = "finished";
    againBtn.classList.remove("hidden");
    shareBtn.classList.remove("hidden");

    btn.style.background = "#122225";
    btn.innerText = "âœ”";
    btn.classList.remove("glow", "readyPulse");
    
    playSound(soundWin);
    safeVibrate([150, 80, 150]);
}

function resetGame() {
    gameState = "idle";
    statusText.innerText = "Press START to begin.";
    
    // YENÄ°: Durumu sÄ±fÄ±rlarken baÅŸarÄ± sÄ±nÄ±fÄ±nÄ± koru
    statusText.classList.remove("status-fail"); 
    statusText.classList.add("status-success"); 
    
    scoreText.classList.add("hidden");
    againBtn.classList.add("hidden");
    shareBtn.classList.add("hidden");

    btn.innerText = "START";
    btn.style.background = "#062e29";
    btn.classList.remove("glow", "readyPulse");
}
</script>

<script type="module">
import * as sdk from "https://esm.sh/@farcaster/miniapp-sdk";

window.farcasterSDK = sdk;

window.addEventListener("DOMContentLoaded", () => {
    try {
        sdk.actions.ready();
        console.log("âœ“ MiniApp READY");
    } catch (err) {
        console.error("MiniApp SDK ready() error:", err);
    }
});

async function shareScore(score) {
    const shareImage = `https://reflex-rho.vercel.app/api/score-image?score=${score}`;

    const text =
        `âš¡ Reflex Test â€” Arcade Mode\n\n` +
        `I just hit **${score}s** âš¡\n` +
        `Think youâ€™re faster? Tap in and prove it. ðŸ‘‡\n\n`;

    const composeUrl =
        "https://warpcast.com/~/compose?text=" +
        encodeURIComponent(text) +
        "&embeds[]=" +
        encodeURIComponent(shareImage);

    try {
        await sdk.actions.openUrl({ url: composeUrl });
    } catch (err) {
        console.log("Share failed:", err);
    }
}
</script>

</body>
</html>
