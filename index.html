<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>REFLEX — TRON EDITION</title>

<link rel="stylesheet" href="style.css" />

<!-- MiniApp -->
<meta name="fc:miniapp" content='{
  "version": "1",
  "imageUrl": "https://reflex-rho.vercel.app/screenshot1.png",
  "button": {
    "title": "ENTER THE GRID",
    "action": {
      "type": "launch_miniapp",
      "url": "https://reflex-rho.vercel.app",
      "name": "Reflex Test",
      "splashImageUrl": "https://reflex-rho.vercel.app/screenshot1.png",
      "splashBackgroundColor": "#03080e"
    }
  }
}' />
</head>

<body>

<!-- BACKGROUND -->
<div class="bg"></div>

<!-- UI -->
<div class="ui">

    <div id="status" class="status">SYSTEM READY</div>

    <!-- TRON Reactor Button -->
    <button id="reactor" class="reactor">
        <div class="ring r1"></div>
        <div class="ring r2"></div>
        <div class="ring r3"></div>
        <div class="core"></div>
        <span class="reactor-text" id="reactorText">START</span>
    </button>

</div>

<!-- SCORE PANEL -->
<div id="scorePanel" class="score-panel">
    <div id="rankTitle" class="rank">UNRANKED</div>
    <div id="score" class="score">0.000</div>

    <div class="panel-buttons">
        <button id="againBtn" class="panel-btn">RETRY</button>
        <button id="shareBtn" class="panel-btn">SHARE</button>
    </div>
</div>

<script src="game.js"></script>

<script type="module">
import { sdk } from "https://esm.sh/@farcaster/miniapp-sdk";

window.shareScore = async function(score) {
    const rank = document.getElementById("rankTitle").innerText;

    const img = `https://reflex-rho.vercel.app/api/score-image?score=${score}&rank=${encodeURIComponent(rank)}`;
    const text = `⚡ ${rank}\nReflex: ${score}s\n\nCan you beat my time?`;

    const url = `https://warpcast.com/~/compose?text=${encodeURIComponent(text)}&embeds[]=${encodeURIComponent(img)}`;

    try { await sdk.actions.openUrl({ url }); } catch(e){}
};

setTimeout(async ()=>{
    try { await sdk.actions.ready(); } catch(e) {}
},200);
</script>

</body>
</html>
